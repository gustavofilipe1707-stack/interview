<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>HSR Unified System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg: #0b111a;
            --card: #161e2b;
            --blue: #00a2ff;
            --green: #00e676;
            --red: #ff5252;
            --yellow: #ffeb3b;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: #cfd8dc;
            margin: 0;
            padding: 20px;
        }

        /* Seletor de Modo Inicial */
        #mode-selector {
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
            background: var(--card);
            padding: 40px;
            border-radius: 15px;
            border: 1px solid var(--blue);
        }

        .btn-mode {
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
            font-size: 1rem;
            transition: 0.3s;
        }

        .btn-agente {
            background: var(--blue);
            color: white;
        }

        .btn-monitor {
            background: #37474f;
            color: white;
        }

        /* Layout Agente */
        #view-agente,
        #view-monitor {
            display: none;
        }

        .agente-container {
            max-width: 600px;
            margin: auto;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 6px solid var(--blue);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #232d3d;
        }

        .val {
            color: #fff;
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        /* Layout Monitoramento */
        .header-mon {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--blue);
            margin-bottom: 20px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .stat-item {
            background: var(--card);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #333;
            font-size: 0.8rem;
        }

        /* Grid Inteligente */
        .station-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            justify-content: center;
            /* Centraliza cards quando s√£o poucos */
            max-width: 1400px;
            margin: auto;
        }

        .station-card {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            border-left: 6px solid #444;
        }

        /* Classes de Status */
        .status-internet-ruim {
            border-left-color: var(--red);
            animation: pulse 2s infinite;
        }

        .status-cpu-ruim {
            border-left-color: var(--yellow);
        }

        .status-ok {
            border-left-color: var(--green);
        }

        .status-offline {
            border-left-color: #455a64;
            opacity: 0.6;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(255, 82, 82, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 82, 82, 0);
            }
        }

        .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .bg-online {
            background: var(--green);
            color: #000;
        }

        .bg-offline {
            background: #455a64;
            color: #fff;
        }
    </style>
</head>

<body>

    <div id="mode-selector">
        <h2 style="color:var(--blue)">SISTEMA HSR</h2>
        <p>Selecione o modo de opera√ß√£o:</p>
        <button class="btn-mode btn-agente" onclick="switchView('agente')">MODO AGENTE</button>
        <button class="btn-mode btn-monitor" onclick="checkPass()">MODO MONITORAMENTO</button>
    </div>

    <div id="view-agente" class="agente-container">
        <div class="card" style="border-left-color: var(--yellow);">
            <h2>üñ•Ô∏è ESTA√á√ÉO: <span id="st-id"
                    style="background:var(--blue); padding:3px 8px; border-radius:4px;">INTERVIEW001</span></h2>
            <div class="info-row"><span>IP P√∫blico:</span> <span id="ip-res" class="val">Buscando...</span></div>
            <div class="info-row"><span>Operadora:</span> <span id="isp-res" class="val">Buscando...</span></div>
        </div>
        <div class="card">
            <h2>üì° CONEX√ÉO E HARDWARE</h2>
            <div class="info-row"><span>Sa√∫de Atual:</span> <span id="ping-val" class="val">--</span></div>
            <div class="info-row"><span>Processador:</span> <span id="cpu-val" class="val">Calculando...</span></div>
            <div style="margin-top:15px; font-size:0.8rem; text-align:center; border:1px dashed #444; padding:10px;">
                M√âDIA 30 MIN: <b id="media-val" class="val" style="font-size:1.1rem">-- ms</b>
            </div>
        </div>
        <button onclick="saveAsJpeg()"
            style="background:var(--green); border:none; padding:12px; border-radius:6px; font-weight:bold; width:100%; cursor:pointer;">üì∏
            SALVAR JPEG</button>
        <p style="text-align:center; font-size:0.7rem; color:gray; margin-top:20px;">HSR Monitor v3.0 - Em transmiss√£o
        </p>
    </div>

    <div id="view-monitor">
        <div class="header-mon">
            <h1 style="margin:0">PORTAL DE CONTROLE HSR</h1>
            <div class="stats-bar">
                <div class="stat-item">Online: <b id="count-online" style="color:var(--green)">0</b></div>
                <div class="stat-item">Internet Ruim: <b id="count-net" style="color:var(--red)">0</b></div>
                <div class="stat-item">CPU Alerta: <b id="count-cpu" style="color:var(--yellow)">0</b></div>
            </div>
        </div>
        <div id="stations-container" class="station-grid">
        </div>
    </div>

    <script>
        // --- L√ìGICA DE NAVEGA√á√ÉO E SEGURAN√áA ---
        function switchView(mode) {
            document.getElementById('mode-selector').style.display = 'none';
            if (mode === 'agente') {
                document.getElementById('view-agente').style.display = 'block';
                startAgente();
            } else {
                document.getElementById('view-monitor').style.display = 'block';
                startMonitor();
            }
        }

        function checkPass() {
            const pass = prompt("Digite a senha de acesso:");
            if (pass === 'hsr') {
                switchView('monitor');
            } else {
                alert("Senha incorreta!");
            }
        }

        // --- L√ìGICA DO AGENTE ---
        let pingHistory = [];
        function startAgente() {
            fetchNetInfo();
            checkCPU();
            setInterval(measurePing, 5000);
            setInterval(checkCPU, 600000);
        }

        function fetchNetInfo() {
            fetch('https://ipapi.co/json/').then(res => res.json()).then(data => {
                document.getElementById('ip-res').innerText = data.ip || "N/A";
                document.getElementById('isp-res').innerText = data.org || "N/A";
            });
        }

        function measurePing() {
            const start = Date.now();
            const img = new Image();
            img.src = "https://hsrpbx.com.br/favicon.ico?t=" + start;
            img.onload = img.onerror = () => {
                const delta = Date.now() - start;
                document.getElementById('ping-val').innerText = delta + " ms";
                pingHistory.push(delta);
                if (pingHistory.length > 360) pingHistory.shift();
                updateAvg();
            };
        }

        function updateAvg() {
            const avg = Math.round(pingHistory.reduce((a, b) => a + b, 0) / pingHistory.length);
            document.getElementById('media-val').innerText = avg + " ms";
        }

        function checkCPU() {
            const cStart = performance.now();
            let count = 0; while (performance.now() - cStart < 150) { count++; }
            document.getElementById('cpu-val').innerText = count > 400000 ? "Excelente" : "Ocupado";
        }

        function saveAsJpeg() {
            html2canvas(document.querySelector("#view-agente")).then(canvas => {
                const link = document.createElement('a');
                link.download = `HSR_AGENTE.jpg`; link.href = canvas.toDataURL('image/jpeg'); link.click();
            });
        }

        // --- L√ìGICA DO MONITOR (Simulada para visualiza√ß√£o) ---
        function startMonitor() {
            // Exemplo de como o grid se comporta com poucas m√°quinas
            const mockData = [
                { name: "INTERVIEW001", ip: "189.10.45.12", latency: "25ms", avg: "28ms", cpu: "Excelente", connection: "online", status: "ok" },
                { name: "INTERVIEW002", ip: "189.10.45.15", latency: "95ms", avg: "110ms", cpu: "Excelente", connection: "online", status: "internet-ruim" }
            ];

            const container = document.getElementById('stations-container');
            container.innerHTML = "";

            mockData.forEach(st => {
                const card = document.createElement('div');
                card.className = `station-card status-${st.status}`;
                card.innerHTML = `
                <div class="station-name">${st.name} <span class="badge bg-online">online</span></div>
                <div class="stat-row"><span>IP:</span> <span class="stat-val">${st.ip}</span></div>
                <div class="stat-row"><span>Sa√∫de:</span> <span class="stat-val">${st.latency}</span></div>
                <div class="stat-row"><span>M√©dia:</span> <span class="stat-val">${st.avg}</span></div>
                <div class="stat-row"><span>CPU:</span> <span class="stat-val">${st.cpu}</span></div>
            `;
                container.appendChild(card);
            });
            document.getElementById('count-online').innerText = "2";
            document.getElementById('count-net').innerText = "1";
        }
    </script>
</body>

</html>