<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>HSR - Check-up em Tempo Real</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #0b111a;
            color: #cfd8dc;
            padding: 20px;
        }

        .diagnostic-container {
            max-width: 600px;
            margin: auto;
        }

        .card {
            background: #161e2b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 6px solid #00a2ff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        h2 {
            color: #00a2ff;
            margin-top: 0;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #232d3d;
        }

        .label {
            color: #90a4ae;
        }

        .val {
            color: #fff;
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        .summary-box {
            background: #1c2738;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px dashed #455a64;
            line-height: 1.5;
        }

        .btn {
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
            text-align: center;
            text-decoration: none;
            display: block;
            margin-top: 10px;
        }

        .btn-save {
            background: #00e676;
            color: #0b111a;
        }

        .btn-anydesk {
            background: #ef4444;
            color: white;
        }

        .link-card {
            background: #1c2738;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            margin-top: 15px;
        }

        .link-item {
            color: #4fc3f7;
            text-decoration: none;
            font-weight: bold;
            display: block;
            margin-top: 5px;
        }

        .excelente {
            color: #00e676;
        }

        .media {
            color: #ffeb3b;
        }

        .ruim {
            color: #ff9100;
        }

        .pessima {
            color: #ff5252;
        }
    </style>
</head>

<body>

    <div id="capture-area" class="diagnostic-container">
        <div class="card">
            <h2>üåê Identifica√ß√£o de Conex√£o</h2>
            <div class="info-row"><span class="label">IP de Internet:</span> <span id="ip-res"
                    class="val">Detectando...</span></div>
            <div class="info-row"><span class="label">Provedor (ISP):</span> <span id="isp-res"
                    class="val">Detectando...</span></div>
            <div class="info-row"><span class="label">Localiza√ß√£o:</span> <span id="geo-res"
                    class="val">Solicitando...</span></div>
        </div>

        <div class="card">
            <h2>üì° Performance HSR (Tempo Real)</h2>
            <div class="info-row"><span class="label">Lat√™ncia:</span> <span id="ping-val"
                    class="val">Testando...</span></div>
            <div class="info-row"><span class="label">Sa√∫de da CPU:</span> <span id="cpu-val"
                    class="val">Testando...</span></div>
        </div>

        <div class="card">
            <h2>üìä Resumo & Diagn√≥stico</h2>
            <div id="summary-text" class="summary-box">Calculando...</div>
        </div>

        <div class="card">
            <h2>üîó Links √öteis</h2>
            <div class="link-card">
                <span style="color: #90a4ae; font-size: 0.8rem;">SISTEMA OPERACIONAL:</span>
                <a href="https://cati.fastquest.net/frmlogin.aspx" target="_blank" class="link-item">‚ûú Login
                    Fastdialer</a>
            </div>
        </div>
    </div>

    <div class="diagnostic-container">
        <button onclick="saveAsJpeg()" class="btn btn-save">üì∏ SALVAR TELA COMO JPEG (PRINT)</button>
        <a href="https://anydesk.com/pt/downloads/thank-you?dv=win_exe" class="btn btn-anydesk">üöÄ BAIXAR ANYDESK</a>
    </div>

    <script>
        // 1. Coleta de IP/Provedor
        function fetchNetInfo() {
            fetch('http://ip-api.com/json/?fields=status,country,regionName,city,isp,query')
                .then(res => res.json())
                .then(data => {
                    if (data.status === "success") {
                        document.getElementById('ip-res').innerText = data.query;
                        document.getElementById('isp-res').innerText = data.isp;
                        document.getElementById('geo-res').innerText = data.city + ", " + data.regionName;
                        window.userCity = data.city;
                    }
                });
        }

        // 2. Teste de CPU (Benchmark Autom√°tico)
        function checkCPU() {
            const start = performance.now();
            let count = 0;
            while (performance.now() - start < 150) { count++; }
            const cpuElem = document.getElementById('cpu-val');
            if (count > 400000) { cpuElem.innerText = "Est√°vel"; cpuElem.className = "val excelente"; }
            else { cpuElem.innerText = "Sobrecarga"; cpuElem.className = "val pessima"; }
        }

        // 3. Teste de Lat√™ncia em Tempo Real
        function measurePing() {
            const start = Date.now();
            const img = new Image();
            img.src = "https://hsrpbx.com.br/favicon.ico?t=" + start;
            img.onload = img.onerror = () => {
                const delta = Date.now() - start;
                const pElem = document.getElementById('ping-val');
                let statusMsg = ""; let sClass = "";

                if (delta <= 30) { statusMsg = "EXCELENTE"; sClass = "excelente"; }
                else if (delta <= 50) { statusMsg = "M√âDIA"; sClass = "media"; }
                else if (delta <= 80) { statusMsg = "RUIM"; sClass = "ruim"; }
                else { statusMsg = "P√âSSIMA"; sClass = "pessima"; }

                pElem.innerText = delta + " ms (" + statusMsg + ")";
                pElem.className = "val " + sClass;

                let resumo = `Sua conex√£o est√° <b>${statusMsg}</b>. `;
                if (delta > 50) resumo += `<br><span style="color:#ff5252">‚ö†Ô∏è Recomenda-se reiniciar o modem e fechar abas.</span>`;
                else resumo += `<br><span style="color:#00e676">‚úÖ Qualidade ideal para voz.</span>`;

                document.getElementById('summary-text').innerHTML = resumo;
            };
        }

        // 4. Salvar como JPEG
        function saveAsJpeg() {
            html2canvas(document.querySelector("#capture-area")).then(canvas => {
                const link = document.createElement('a');
                link.download = 'diagnostico_hsr.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            });
        }

        // Inicializa√ß√£o e Loops
        fetchNetInfo();
        checkCPU();
        measurePing();
        setInterval(measurePing, 5000); // Lat√™ncia a cada 5s
        setInterval(checkCPU, 10000);   // CPU a cada 10s
    </script>
</body>

</html>
